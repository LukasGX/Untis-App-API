<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Chat: {{ school }}</title>
		<style>
			body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; min-height: 100vh; padding: 20px; }
			.container { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 24px; padding: 40px; max-width: 800px; margin: 0 auto; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
			h1 { font-size: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px; }
			.message { background: white; border-radius: 16px; padding: 20px; margin: 15px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #10b981; }
			.message.deleted { opacity: 0.6; border-left-color: #6b7280; text-decoration: line-through; }
			.message.system { border-left-color: #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
			.message-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; }
			.username { font-weight: 600; color: #1f2937; }
			.username.system { color: #d97706; font-weight: 700; }
			.timestamp { color: #6b7280; font-size: 14px; }
			.delete-btn { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
			.delete-btn:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(239,68,68,0.4); }
			.restore-btn { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
			.restore-btn:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(16,185,129,0.4); }
			.back-btn { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); color: white; padding: 12px 24px; border-radius: 12px; text-decoration: none; display: inline-block; margin-bottom: 20px; }
			.system-form { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 16px; padding: 20px; margin: 20px 0; border-left: 5px solid #f59e0b; }
			.system-input { width: 100%; padding: 12px; border: 2px solid #fbbf24; border-radius: 12px; font-size: 16px; margin-bottom: 12px; box-sizing: border-box; }
			.system-btn { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-right: 10px; }
			.system-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(245,158,11,0.4); }
			.template-btn { background: linear-gradient(135deg, #ec4899 0%, #be185d 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-right: 10px; font-size: 14px; }
			.template-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(236,72,153,0.4); }
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Chat: {{ school }}</h1>
			<a href="/admin/dashboard" class="back-btn">‚Üê Dashboard</a>

			<!-- üî• SYSTEM-NACHRICHT FORM MIT VORLAGEN -->
			<form
				action="/admin/chats/{{ school }}/system"
				method="POST"
				class="system-form">
				<input
					type="text"
					name="message"
					class="system-input"
					id="systemMessage"
					placeholder="System-Nachricht eingeben (max 200 Zeichen)..."
					maxlength="200"
					required />

				<!-- üî• VORLAGEN-BUTTONS -->
				<div
					style="display: flex; gap: 0.4rem; flex-wrap: wrap; margin-top: 10px;">
					<button
						type="button"
						class="template-btn warn"
						onclick="setTemplate('warn', true, 'Grund')">
						Verwarnung
					</button>

					<button
						type="button"
						class="template-btn ban"
						onclick="setTemplate('ban')">
						Ban
					</button>

					<button
						type="button"
						class="template-btn ban"
						onclick="setTemplate('unban')">
						Unban
					</button>

					<button type="submit" class="system-btn">Senden</button>

					<button
						type="button"
						class="system-btn"
						onclick="clearMessage()">
						Leeren
					</button>
				</div>
			</form>

			{% for msg in messages %}
			<div
				class="message {% if msg['deleted'] %}deleted{% endif %} {% if msg['username'] == '[SYSTEM]' %}system{% endif %}">
				<div class="message-header">
					<div>
						<span
							class="username {% if msg['username'] == '[SYSTEM]' %}system{% endif %}"
							>{{ msg['username'] }}</span
						>
						<span class="timestamp">{{ msg['sent_at'][:16] }}</span>
					</div>
					{% if not msg['deleted'] %}
					<form
						action="/admin/chats/{{ school }}/{{ msg['id'] }}/delete"
						method="POST"
						style="display: inline;">
						<button class="delete-btn" type="submit">
							L√∂schen
						</button>
					</form>
					{% else %}
					<form
						action="/admin/chats/{{ school }}/{{ msg['id'] }}/restore"
						method="POST"
						style="display: inline;">
						<button class="restore-btn" type="submit">
							Wiederherstellen
						</button>
					</form>
					{% endif %}
				</div>
				<div>{{ msg['message'] }}</div>
			</div>
			{% endfor %}
		</div>

		<script>
			function setTemplate(type, double = false, secondQuestion) {
			    const input = document.getElementById('systemMessage');
			    const user = prompt('Benutzername eingeben:');
			    if (user === null) return;

				let secondAnswer = "";
				if (double == true) {
					secondAnswer = prompt(`${secondQuestion} eingeben:`);
				}

			    if (type === 'warn') {
			        input.value = `Verwarnung f√ºr ${user} wegen ${secondAnswer}`;
			    }
				else if (type === 'ban') {
			        input.value = `Der Benutzer ${user} wurde von der Chat-Funktion ausgeschlossen`;
			    }
				else if (type === 'unban') {
			        input.value = `Der Benutzer ${user} wurde f√ºr die Chat-Funktion freigegeben`;
			    }
			    input.focus();
			    input.select();
			}

			function clearMessage() {
			    document.getElementById('systemMessage').value = '';
			}
		</script>
	</body>
</html>
